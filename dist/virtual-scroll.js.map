{"version":3,"file":"virtual-scroll.js","sourceRoot":"","sources":["../src/virtual-scroll.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Component,\n    ElementRef,\n    EventEmitter,\n    Input,\n    ModuleWithProviders,\n    NgModule,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    Output,\n    Renderer,\n    SimpleChanges,\n    ViewChild,\n} from '@angular/core';\n\nimport { CommonModule } from '@angular/common';\n\nexport interface ChangeEvent {\n    start?: number;\n    end?: number;\n}\n\n@Component({\n    selector: 'virtual-scroll',\n    template: `\n        <div class=\"total-padding\" [style.height]=\"scrollHeight + 'px'\"></div>\n        <div class=\"scrollable-content\" #content [style.transform]=\"'translateY(' + topPadding + 'px)'\">\n            <ng-content></ng-content>\n        </div>\n    `,\n    styles: [`\n        :host {\n            overflow: auto;\n            overflow-y: auto;\n            position: relative;\n            -webkit-overflow-scrolling: touch;\n        }\n        .scrollable-content {\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            position: absolute;\n        }\n        .total-padding {\n            width: 1px;\n            opacity: 0;\n        }\n    `]\n})\nexport class VirtualScrollComponent implements OnInit, OnDestroy, OnChanges {\n\n    @Input()\n    items: any[] = [];\n\n    @Input()\n    scrollbarWidth: number;\n\n    @Input()\n    scrollbarHeight: number;\n\n    @Input()\n    childWidth: number;\n\n    @Input()\n    childHeight: number;\n\n    @Output()\n    update: EventEmitter<any[]> = new EventEmitter<any[]>();\n\n    @Output()\n    change: EventEmitter<ChangeEvent> = new EventEmitter<ChangeEvent>();\n\n    @ViewChild('content', { read: ElementRef })\n    protected contentElementRef: ElementRef;\n\n    private onScrollListener: Function;\n    private topPadding: number;\n    private scrollHeight: number;\n    private previousStart: number;\n    private previousEnd: number;\n    private startupLoop: boolean = true;\n\n    constructor(private element: ElementRef, private renderer: Renderer) { }\n\n    ngOnInit() {\n        this.onScrollListener = this.renderer.listen(this.element.nativeElement, 'scroll', this.refresh.bind(this));\n        this.scrollbarWidth = 0; // this.element.nativeElement.offsetWidth - this.element.nativeElement.clientWidth;\n        this.scrollbarHeight = 0; // this.element.nativeElement.offsetHeight - this.element.nativeElement.clientHeight;\n    }\n\n    ngOnChanges(changes: SimpleChanges) {\n        this.previousStart = undefined;\n        this.previousEnd = undefined;\n        this.refresh();\n    }\n\n    ngOnDestroy() {\n        this.onScrollListener();\n    }\n\n    refresh() {\n        requestAnimationFrame(this.calculateItems.bind(this));\n    }\n\n    scrollInto(item: any) {\n        let index: number = (this.items || []).indexOf(item);\n        if (index < 0 || index >= (this.items || []).length) return;\n\n        let d = this.calculateDimensions();\n        this.element.nativeElement.scrollTop = Math.floor(index / d.itemsPerRow) *\n            d.childHeight - Math.max(0, (d.itemsPerCol - 1)) * d.childHeight;\n        this.refresh();\n    }\n\n    private countItemsPerRow() {\n        let offsetTop;\n        let itemsPerRow;\n        let children = this.contentElementRef.nativeElement.children;\n        for (itemsPerRow = 0; itemsPerRow < children.length; itemsPerRow++) {\n            if (offsetTop != undefined && offsetTop !== children[itemsPerRow].offsetTop) break;\n            offsetTop = children[itemsPerRow].offsetTop;\n        }\n        return itemsPerRow;\n    }\n\n    private calculateDimensions() {\n        let el = this.element.nativeElement;\n        let content = this.contentElementRef.nativeElement;\n\n        let items = this.items || [];\n        let itemCount = items.length;\n        let viewWidth = el.clientWidth - this.scrollbarWidth;\n        let viewHeight = el.clientHeight - this.scrollbarHeight;\n\n        let contentDimensions;\n        if (this.childWidth == undefined || this.childHeight == undefined) {\n            contentDimensions = content.children[0] ? content.children[0].getBoundingClientRect() : {\n                width: viewWidth,\n                height: viewHeight\n            };\n        }\n        let childWidth = this.childWidth || contentDimensions.width;\n        let childHeight = this.childHeight || contentDimensions.height;\n\n        let itemsPerRow = Math.max(1, this.countItemsPerRow());\n        let itemsPerRowByCalc = Math.max(1, Math.floor(viewWidth / childWidth));\n        let itemsPerCol = Math.max(1, Math.floor(viewHeight / childHeight));\n        if (itemsPerCol === 1 && Math.floor(el.scrollTop / this.scrollHeight * itemCount) + itemsPerRowByCalc >= itemCount) {\n            itemsPerRow = itemsPerRowByCalc;\n        }\n\n        return {\n            itemCount: itemCount,\n            viewWidth: viewWidth,\n            viewHeight: viewHeight,\n            childWidth: childWidth,\n            childHeight: childHeight,\n            itemsPerRow: itemsPerRow,\n            itemsPerCol: itemsPerCol,\n            itemsPerRowByCalc: itemsPerRowByCalc\n        };\n    }\n\n    private calculateItems() {\n        let el = this.element.nativeElement;\n\n        let d = this.calculateDimensions();\n        let items = this.items || [];\n        this.scrollHeight = d.childHeight * d.itemCount / d.itemsPerRow;\n        if (this.element.nativeElement.scrollTop > this.scrollHeight) {\n            this.element.nativeElement.scrollTop = this.scrollHeight;\n        }\n\n        let start = Math.floor(el.scrollTop / this.scrollHeight * d.itemCount / d.itemsPerRow) * d.itemsPerRow;\n        let end = Math.min(d.itemCount, Math.ceil(el.scrollTop / this.scrollHeight * d.itemCount / d.itemsPerRow) * d.itemsPerRow +\n            d.itemsPerRow * (d.itemsPerCol + 1));\n\n        this.topPadding = d.childHeight * Math.ceil(start / d.itemsPerRow);\n        if (start !== this.previousStart || end !== this.previousEnd) {\n            this.update.emit(items.slice(start, end));\n            this.previousStart = start;\n            this.previousEnd = end;\n            if (this.startupLoop === true) {\n                this.refresh();\n            } else {\n                this.change.emit({\n                    start: start,\n                    end: end\n                });\n            }\n        } else {\n            this.startupLoop = false;\n        }\n    }\n}\n\n@NgModule({\n    imports: [CommonModule],\n    declarations: [VirtualScrollComponent],\n    exports: [VirtualScrollComponent]\n})\nexport class VirtualScrollModule {\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}